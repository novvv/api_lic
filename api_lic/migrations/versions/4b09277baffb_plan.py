"""plan

Revision ID: 4b09277baffb
Revises: 802754132737
Create Date: 2018-10-29 15:32:24.592975

"""
from alembic import op
import sqlalchemy as sa
import api_lic.migration_types


# revision identifiers, used by Alembic.
revision = '4b09277baffb'
down_revision = '802754132737'
branch_labels = None
depends_on = None


def upgrade():
    #connection = op.get_bind()
    #connection.execute('delete from users')
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('plan',
    sa.Column('plan_uuid', sa.String(length=36), server_default=sa.text('uuid_generate_v4()'), nullable=False),
    sa.Column('type', api_lic.migration_types.ChoiceType({}), nullable=True),
    sa.Column('amount', api_lic.migration_types.Numeric(), server_default='0', nullable=False),
    sa.PrimaryKeyConstraint('plan_uuid')
    )

    op.add_column('license', sa.Column('plan_uuid', sa.String(length=36), nullable=True))
    op.create_index(op.f('ix_license_plan_uuid'), 'license', ['plan_uuid'], unique=False)
    op.drop_index('ix_license_rate_uuid', table_name='license')
    op.drop_constraint('license_rate_uuid_fkey', 'license', type_='foreignkey')
    op.create_foreign_key(None, 'license', 'plan', ['plan_uuid'], ['plan_uuid'], ondelete='CASCADE')
    op.drop_column('license', 'rate_uuid')
    op.drop_table('rate')
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('license', sa.Column('rate_uuid', sa.VARCHAR(length=36), autoincrement=False, nullable=True))
    op.drop_constraint(None, 'license', type_='foreignkey')
    op.create_foreign_key('license_rate_uuid_fkey', 'license', 'rate', ['rate_uuid'], ['rate_uuid'], ondelete='CASCADE')
    op.create_index('ix_license_rate_uuid', 'license', ['rate_uuid'], unique=False)
    op.drop_index(op.f('ix_license_plan_uuid'), table_name='license')
    op.drop_column('license', 'plan_uuid')
    op.create_table('rate',
    sa.Column('rate_uuid', sa.VARCHAR(length=36), server_default=sa.text('uuid_generate_v4()'), autoincrement=False, nullable=False),
    sa.Column('type', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('rate', sa.NUMERIC(), server_default=sa.text("'0'::numeric"), autoincrement=False, nullable=False),
    sa.PrimaryKeyConstraint('rate_uuid', name='rate_pkey')
    )
    op.drop_table('plan')
    # ### end Alembic commands ###
